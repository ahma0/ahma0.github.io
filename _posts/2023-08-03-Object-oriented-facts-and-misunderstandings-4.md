---
title: 객체지향의 사실과 오해 - 04. 역할, 책임, 협력
author: dnya0
date:   2023-08-03 20:32:00 +0900
categories: [Study, 객체지향의 사실과 오해]
tag: [Study, 객체지향의 사실과 오해]
math: true
mermaid: true
image:
  path: https://github.com/dnya0/dnya0/assets/84761609/7c4db4bc-7e95-4acd-9a5f-0b93e6f5afdc
  alt: book image
---

> [객체지향의 사실과 오해](https://product.kyobobook.co.kr/detail/S000001628109)를 읽고 정리한 글입니다.
{: .prompt-info }

<br>

## 협력

### 요청하고 응답하며 협력하는 사람들

협력은 다수의 요청과 응답으로 구성되며 전체적으로 협력은 연쇄적인 요청과 응답의 흐름으로 구성된다.

![연쇄적인 요청과 응답의 흐름으로 구성된 협력](https://github.com/dnya0/dnya0/assets/84761609/0232aa54-9cc3-4c75-8e0c-160b341f25ed)

<br>

### 누가 파이를 훔쳤지?

앨리스의 이야기에서 재판 장면에 등장하는 모든 등장인물은 객체다. 왕과 하얀 토끼, 모자 장수라고 불리는 객체들은 하트 잭을 재판하기 위해 서로 협력하고 있다. 즉, 이 이야기의 등장하는 객체들은 하트 잭의 재판이라는 동일한 목적을 달성하기 위해 협력하고 있는 것이다.

<br>

### 재판 속의 협력

왕이 모자 장수로부터 증언을 듣는 과정

- 누군가가 왕에게 재판을 **요청**함으로써 재판이 시작된다.
- 왕이 하얀 토끼에게 증인을 부를 것을 **요청**한다.
- 왕의 요청을 받은 토끼는 모자 장수에게 증인석으로 입장할 것을 **요청**한다.
- 모자 장수는 증인석에 입장함으로써 토끼의 요청에 **응답**한다.
- 모자 장수의 입장은 왕이 토끼에게 요청했던 증인 호출에 대한 **응답**이기도 하다.
- 이제 왕은 모자 장수에게 증언할 것을 **요청**한다.
- 모자 장수는 자신이 알고 있는 내용을 증언함으로써 왕의 요청에 **응답**한다.

아래 그림은 왕과 하얀 토끼, 모자 장수 사이의 협력 관계를 그림으로 표현한 것이다.

![왕과 하얀 토끼, 모자 장수 사이의 협력 관계](https://github.com/dnya0/dnya0/assets/84761609/62056c4d-e6d9-4077-ac90-26e61ad369e3)

- 화살표: 특정 인물에게 보내지는 요청
- 문장 앞의 번호: 요청이 발생하는 순서

협력 안의 요청과 응답에 초점을 맞춰보자.

- 어떤 등장인물들이 특정한 요청을 받아들일 수 있는 이유는 그 요청에 대해 적절한 방식으로 응답하는 데 필요한 지식과 행동방식을 가지고 있기 때문
    - 누군가 왕에게 재판을 해달라는 요청을 보냈다는 말은 **왕이 재판을 수행할 의무가 있으며, 재판에 필요한 지식을 가지고 있음**을 의미
    - 왕이 하얀 토끼에게 목격자를 불러오라고 요청한 이유는 **토끼가 목격자에 대해 알고 있으며 동시에 목격자를 부를 의무가 있기 때문**

<br>

## 책임

어떤 객체가 어떤 요청에 대해 대답해줄 수 있거나, 적절한 행동을 할 의무가 있는 경우 해당 객체가 책임을 가진다고 한다. 어떤 대상에 대한 요청은 그 대상이 요청을 처리할 책임이 있음을 암시한다.

> "객체지향 개발에서 가장 중요한 능력은 책임을 능숙하게 소프트웨어 객체에 할당하는 것" [Larman 2004]

<br>

### 책임의 분류

책임은 객체에 의해 정의되는 응집도 있는 행위의 집합으로, 객체가 알아야 하는 정보와 객체가 수행할 수 있는 행위에 대해 개략적으로 서술한 문장이다. 즉, 객체의 책임은 '객체가 무엇을 알고 있는가(knowing)'와 '무엇을 할 수 있는가(doing)'로 구성된다.

- 하는 것(doing)
    - 객체를 생성하거나 계산을 하는 등의 스스로 하는 것
    - 다른 객체의 행동을 시작시키는 것
    - 다른 객체의 활동을 제어하고 조절하는 것
- 아는 것(knowing)
    - 개인적인 정보에 관해 아는 것
    - 관련된 객체에 관해 아는 것
    - 자신이 유도하거나 계산할 수 있는 것에 관해 아는 것

위 그림을 통해 두 가지 범주의 책임을 발견해보자

- 왕은 하얀 토끼에게 목격자를 불러오도록 요청하고, 목격자인 모자 장수에게 증언을 하라고 요청
    - 재판에 참여하는 "다른 객체들의 활동을 제어하고 조율" 
    - **하는 것**과 관련된 책임 수행
- 하얀 토끼는 목격자가 모자 장수라는 사실을 알고 있으며, 동시에 모자 장수가 증인석에 입장하도록 요청
    - 첫 번째 책임: "관련된 객체에 대해 아는 것"
    - 두 번째 책임: "다른 객체의 행동을 시작시키는 것"
    - **아는 것**과 **하는 것** 두 가지 종류의 책임 모두 수행
- 모자 장수의 경우 스스로 증인석에 입장해야 하는 책임과 자신이 알고 있는 사실을 증언해야하는 책임을 갖고있음
    - 첫 번째 책임: "객체를 생성하거나 계산을 하는 등의 스스로 하는 것"
    - 두 번째 책임: "자신이 유도하거나 계산할 수 있는 것에 관해 아는 것"
    - **아는 것**과 **하는 것** 두 가지 종류의 책임 모두 수행

![왕과 하얀 토끼, 모자 장수 사이의 협력 관계](https://github.com/dnya0/dnya0/assets/84761609/36bba46b-e2ea-4a2e-8350-76384ca85afb)

- 책임은 객체의 외부에 제공해줄 수 있는 정보(아는 것의 측면)와 외부에 제공해 줄 수 있는 서비스(하는 것의 측면)의 목록
- 책임은 객체의 **공용 인터페이스(public interface)**를 구성

<br>

### 책임과 메시지

책임과 메시지의 수준은 같지 않다

- 책임은 객체가 협력에 참여하기 위해 수행해야 하는 행위를 상위 수준에서 개략적으로 서술한 것
- 책임을 결정한 후 실제로 협력을 정제하면서 이를 메시지로 변환할 때는 **하나의 책임이 여러 메시지로 분할**되는 것이 일반적

<br>

## 역할

### 책임의 집합이 의미하는 것

어떤 객체가 수행하는 책임의 집합은 객체가 협력 안에서 수행하는 역할을 암시한다.

<br>

### 판사와 증인

아래는 모자 장수가 증인석에 입장해서 증언하기까지의 협력과정이다.

- 누군가가 **"왕"**에게 재판을 요청함으로써 재판이 시작된다.
- **"왕"**이 하얀 토끼에게 증인을 부를 것을 요청한다.
- **"왕"**의 요청을 받은 토끼는 **"모자 장수"**에게 증인석으로 입장할 것을 요청한다.
- **"모자 장수"**는 증인석에 입장함으로써 토끼의 요청에 응답한다.
- **"모자 장수"**의 입장은 연쇄적으로 토끼에 대한 **"왕"**의 요청에 대한 응답이기도 하다.
- 이제 **"왕"**은 **"모자 장수"**에게 증언할 것을 요청한다.
- **"모자 장수"**는 자신이 알고 있는 내용을 증언함으로써 **"왕"**의 요청에 응답한다.

요리사가 증언을 하는 경우에도 재판 과정은 위와 동일하다.

- 누군가가 **"왕"**에게 재판을 요청함으로써 재판이 시작된다.
- **"왕"**이 하얀 토끼에게 증인을 부를 것을 요청한다.
- **"왕"**의 요청을 받은 토끼는 **"요리사"**에게 증인석으로 입장할 것을 요청한다.
- **"요리사"**는 증인석에 입장함으로써 토끼의 요청에 응답한다.
- **"요리사"**의 입장은 연쇄적으로 토끼에 대한 **"왕"**의 요청에 대한 응답이기도 하다.
- 이제 **"왕"**은 **"요리사"**에게 증언할 것을 요청한다.
- **"요리사"**는 자신이 알고 있는 내용을 증언함으로써 **"왕"**의 요청에 응답한다.

앨리스가 증언을 하는 장면에 이르면 왕은 여왕으로, 모자 장수와 요리사의 자리는 앨리스로 바뀐다.

- 누군가가 **"여왕"**에게 재판을 요청함으로써 재판이 시작된다.
- **"여왕"**이 하얀 토끼에게 증인을 부를 것을 요청한다.
- **"여왕"**의 요청을 받은 토끼는 **"앨리스"**에게 증인석으로 입장할 것을 요청한다.
- **"앨리스"**는 증인석에 입장함으로써 토끼의 요청에 응답한다.
- **"앨리스"**의 입장은 연쇄적으로 토끼에 대한 **"여왕"**의 요청에 대한 응답이기도 하다.
- 이제 **"여왕"**은 **"앨리스"**에게 증언할 것을 요청한다.
- **"앨리스"**는 자신이 알고 있는 내용을 증언함으로써 **"여왕"**의 요청에 응답한다.

<br>

### 역할이 답이다.

'판사'와 '증인'이라는 **역할(role)**을 사용하면 세 가지 협력을 모두 포괄할 수 있는 하나의 협력으로 추상화할 수 있다.

- 누군가가 **"판사"**에게 재판을 요청함으로써 재판이 시작된다.
- **"판사"**는 하얀 토끼에게 증인을 부를 것을 요청한다.
- **"판사"**의 요청을 받은 토끼는 **"증인"**에게 증인석으로 입장할 것을 요청한다.
- **"증인"**은 증인석에 입장함으로써 토끼의 요청에 응답한다.
- **"증인"**의 입장은 연쇄적으로 토끼에 대한 **"판사"**의 요청에 대한 응답이기도 하다.
- 이제 **"판사"**는 **"증인"**에게 증언할 것을 요청한다.
- **"증인"**은 자신이 알고 있는 내용을 증언함으로써 **"판사"**의 요청에 응답한다.

역할은 협력 내에서 다른 객체로 대체할 수 있음을 나타내는 일종의 표식이다.

![판사, 토끼, 증인의 협력 관계](https://github.com/dnya0/dnya0/assets/84761609/0f50c386-782f-41b1-93ef-949d4de7c6f1)

역할을 이용해 협력을 추상화했기 때문에 '판사'나 '증인'의 역할을 수행할 수 있는 어떤 객체라도 협력에 참여할 수 있는 것이다. 그러나 역할을 대체할 수 있는 객체는 메시지를 이해할 수 있는 객체로 한정된다. 동일한 역할을 수행할 수 있다는 것은 해당 객체들이 협력 내에서 동일한 책임의 집합을 수행할 수 있다는 것을 의미한다. 동일한 역할을 수행하는 객체들이 동일한 메시지를 수신할 수 있다는 뜻이다.

![판사, 토끼, 증인의 협력 관계](https://github.com/dnya0/dnya0/assets/84761609/79676ae6-bc10-437c-8e05-ad77b36af726)

- 역할의 개념을 사용하면 유사한 협력을 추상화해서 인지 과부하를 줄일 수 있음
- 협력이 유연해지며 객체들의 재사용성이 높아짐
- **단순성(simplicity)**, **유연성(flexibility)**, **재사용성(reusability)**

<br>

### 협력의 추상화

- 역할을 이용하면 협력을 추상화함으로써 단순화
    - 역할은 하나의 협력 안에 여러 종류의 객체가 참여할 수 있게 함으로써 협력을 추상화할 수 있다는 것
    - 협력의 추상화는 설계자가 다뤄야 하는 협력의 개수를 줄이는 동시에 구체적인 객체를 추상적인 역할로 대체함으로써 협력의 양상을 단순화
- 구체적인 객체로 추상적인 역할을 대체해서 동일한 구조의 협력을 다양한 문맥에서 재사용할 수 있는 능력은 과거의 전통적인 패러다임과 구분되는 객체지향만의 힘

<br>

### 대체 가능성

역할은 협력 안에서 구체적인 객체로 대체될 수 있는 추상적인 협력자다.

- 객체는 협력 안에서 역할이 수행할 수 있는 행동을 그대로 수행할 수 있어야 함
- 객체가 역할을 대체 가능하기 위해서는 협력 안에서 역할이 수행하는 모든 책임을 동일하게 수행할 수 있어야 함
- 객체가 역할에 주어진 책임 이외에 다른 책임을 수행할 수도 있음
- 객체는 역할이 암시하는 책임보다 더 많은 책임을 가질 수 있음
- 대부분의 경우 객체의 타입과 역할 사이에는 **일반화/특수화 관계**가 성립하는 것이 일반적
- 역할이 협력을 추상적으로 만들 수 있는 이유는 역할 자체가 객체의 추상화이기 때문

역할의 대체 가능성은 행위 호환성을 의미하고, 행위 호환성은 동일한 책임의 수행을 의미한다.

<br>

## 객체지향 설계 기법

- **책임-주도 설계(Responsibility-Driven Design)**
    - 협력에 필요한 책임들을 식별하고 적합한 객체에게 책임을 할당하는 방식
    - 객체지향 패러다임의 전문가들이 애플리케이션을 개발할 때 어떤 방식으로 사고하고 무엇을 기반으로 의사결정을 내리는지 보여줌
- **디자인 패턴(Design Pattern)**
    - 전문가들이 반복적으로 사용하는 해결 방법을 정의해 놓은 설계 템플릿의 모음
    - 패턴은 전문가들이 특정 문제를 해결하기 위해 이미 식별해 놓은 역할, 책임, 협력의 모음
- **테스트-주도 개발(Test-Driven Development)**
    - 테스트를 먼저 작성하고 테스트를 통과하는 구체적인 코드를 추가하면서 애플리케이션을 완성해가는 방식
    - 테스트가 아니라 설계를 위한 기법
    - 구체적인 코드를 작성해나가면서 역할, 책임, 협력을 식별하고 역할, 책임, 협력이 적합한지를 피드백 받는 것

<br>

### 책임-주도 설계

- 시스템의 기능은 더 작은 규모의 책임으로 분할되고 각 책임은 책임을 수행할 적절한 객체에게 할당
- 객체가 책임을 수행하는 도중에 스스로 처리할 수 없는 정보나 기능이 필요한 경우 적절한 객체를 찾아 필요한 작업을 요청
- 객체가 다른 객체에게 작업을 요청하는 행위를 통해 결과적으로 객체들 간의 협력 관계가 만들어짐
- 시스템의 책임을 객체의 책임으로 변환
- 각 객체가 책임을 수행하는 중에 필요한 정보나 서비스를 제공해줄 협력자를 찾아 해당 협력자에게 책임을 할당하는 순차적인 방식
- **객체의 상태가 아니라 객체의 책임과 상호작용에 집중**
- 시스템은 스스로 자신을 책임질 수 있을 정도로 충분히 자율적인 동시에 다른 객체와 우호적으로 협력할 수 있을 정도로 충분히 협조적인 객체들로 이뤄진 생태계를 구성

협조적이고 성실한 객체 시민들로 구성된 객체지향 시스템을 설계하는 절차는 다음과 같이 요약된다

- 시스템이 사용자에게 제공해야 하는 기능인 시스템 책임을 파악한다.
- 시스템 책임을 더 작은 책임으로 분할한다.
- 분할된 책임을 수행할 수 있는 적절한 객체 또는 역할을 찾아 책임을 할당한다.
- 객체가 책임을 수행하는 중에 다른 객체의 도움이 필요한 경우 이를 책임질 적절한 객체 또는 역할을 찾는다.
- 해당 객체 또는 역할에게 책임을 할당함으로써 두 객체가 협력하게 한다.

<br>

### 디자인 패턴

- 모범이 되는 설계
- 패턴은 특정한 상황에서 설계를 돕기 위해 모방하고 수정할 수 있는 과거의 설계 경험
- 반복적으로 발생하는 문제와 그 문제에 대한 해법의 쌍으로 정의됨
- 해결하려고 하는 문제가 무엇인지를 명확하게 서술하고, 패턴을 적용할 수 있는 상황과 적용할 수 없는 상황을 함께 설명
- 반복해서 일어나는 특정한 상황에서 어떤 설계가 왜(why) 더 효과적인지에 대한 이유를 설명
- 전체와 부분을 하나의 단위로 추상화해야 하는 경우에 사용할 수 있는 패턴
- 책임-주도 설계의 절차를 순차적으로 따르지 않고도 시스템 안에 구현할 객체들의 역할과 책임, 협력 관계를 빠르고 손쉽게 포착할 수 있음
- 책임-주도 설계의 결과물인 동시에 지름길

<br>

### 테스트-주도 개발

- 애자일 방법론의 한 종류인 XP의 기본 프랙티스로 소개되면서 주목받기 시작한 설계 기법
- 실패하는 테스트를 작성하고, 테스트를 통과하는 가장 간단한 코드를 작성한 후 리팩터링(Refactoring)을 통해 중복을 제거
- '작동하는 깔끔한 코드(clean code that works)'를 얻을 수 있음
- 응집도가 높고 결합도가 낮은 클래스로 구성된 시스템을 개발할 수 있게 하는 최상의 프랙티스
- 객체가 이미 존재한다고 가정하고 객체에게 어떤 메시지를 전송할 것인지에 관해 먼저 생각하라고 충고
- 책임을 수행할 객체 또는 클라이이언트가 기대하는 객체의 역할이 메시지를 수신할 때 어떤 결과를 반환하고 그 과정에서 어떤 객체와 협력할 것인지에 대한 기대를 코드의 형태로 작성하는 것
- 책임-주도 설계의 기본 개념을 따름
- 책임-주도 설계를 통해 도달해야 하는 목적지를 테스트라는 안전장치를 통해 좀 더 빠르고 견고한 방법으로 도달할 수 있도록 해주는 최상의 설계 프랙티스
- 객체지향에 대한 깊이 있는 지식을 요구함
- 책임-주도 설계의 기본 개념과 다양한 원칙과 프랙티스, 패턴을 종합적으로 이해하고 좋은 설계에 대한 감각과 경험을 길러야만 적용할 수 있는 설계 기법